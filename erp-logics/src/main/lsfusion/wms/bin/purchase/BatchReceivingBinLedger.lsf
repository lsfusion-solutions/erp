MODULE BatchReceivingBinLedger;

REQUIRE ReceivingBinLedger, BatchBinTransferBinLedger;

NAMESPACE Purchase;

@defineDocumentDetailBatchCustom(receivingDetail, batch);
idBatch 'Код партии' (ReceivingDetail detail) = id(batch(detail)) CHARWIDTH 10;

batch[BinLedger] (ReceivingBinLedger ledger) += batch(receivingDetail(ledger));

CONSTRAINT DROPPED(Batch b IS Batch) AND [GROUP MAX ReceivingDetail d BY PREV(batch(d))](b)
    MESSAGE 'Запрещено удалять партии по которым создана приемка!';

receivingQuantity 'Принятое кол-во' = GROUP SUM quantity(ReceivingDetail detail) BY batch(detail);

CONSTRAINT receivingQuantity(Batch batch)>quantity(batch)
    MESSAGE 'Нельзя принять по партии больше, чем кол-во в партии';