MODULE PurchaseReturnOrderBinLedger;

REQUIRE PurchaseReturnOrder, BinLedger, PurchaseBinLedger;

NAMESPACE PurchaseReturn;

@defineDocumentBins(order, out, ' (из)');

@implementAggregationBinLedger(orderDetail, order, Order, sku, quantity, customerStock);
@implementBinLedger(orderBinLedger, orderDetail, sku, quantity, customerStock, outBin);
needToCreate (OrderDetail orderDetail) += outBin(orderDetail) AND NOT (isClosed(orderDetail) AND NOT shipped(orderDetail));

@setBinDocument(UserOrder, customerStock, out);
@defineBinDocumentConstraintsType(userOrder, customerStock, out);

backgroundBins 'Цвет' (UserOrder order) = RGB(255, 224, 255) IF order IS UserOrder;
backgroundBins (UserOrderDetail detail) = backgroundBins(order(detail));

@extendObjectFormsBins(userOrder, orders, o, customerStock, backgroundBins, out);

DESIGN userOrder {
    headerExtraParams {
        lines = 4;
    }
}

@deriveDocumentOperationProperty(UserOrder, useBins);

@deriveDocumentBins (userOrder, userOrder, outBin, outBin, customerStock);