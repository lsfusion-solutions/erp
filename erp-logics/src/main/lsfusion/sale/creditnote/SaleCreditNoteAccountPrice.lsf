MODULE SaleCreditNoteAccountPrice;

REQUIRE SaleCreditNote;

NAMESPACE Sale;

@defineDocumentDetailPriceCustomPrefix(userCreditNoteDetail, shipment, ' (учетная)');

CONSTRAINT shipmentPrice(UserCreditNoteDetail detail) < 0.0
    MESSAGE 'Учетная цена для строки акта расхождения (продажа) должна быть больше нуля';

@deriveDocumentDetailPriceAccountBatchDisable (userCreditNote, shipment, sku, supplierStock);

calcShipmentSum = ABSTRACT VALUE NUMERIC[18,4] (UserCreditNoteDetail);
calcShipmentSum(UserCreditNoteDetail userCreditNoteDetail) += NUMERIC[18,4](Utils.round(quantity(userCreditNoteDetail) * shipmentPrice(userCreditNoteDetail), defaultRound(currency(userCreditNoteDetail))));
shipmentSum (UserCreditNoteDetail userCreditNoteDetail) <- calcShipmentSum(userCreditNoteDetail)
    WHEN DO CHANGED(quantity(userCreditNoteDetail)) OR CHANGED (shipmentPrice(userCreditNoteDetail)) OR CHANGED(currency(userCreditNoteDetail));

