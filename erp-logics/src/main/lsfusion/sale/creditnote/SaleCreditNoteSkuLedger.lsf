MODULE SaleCreditNoteSkuLedger;

REQUIRE SaleCreditNoteAccountPrice;

NAMESPACE Sale;

@fillCreditNoteShipmentQuantity ();

@defineUserCreditNoteFormProperties ();

// ------------------------------- Проведение по товарному отчету ------------------------ //
@implementStockDocumentLedgerInc(UserCreditNote, supplierStock);

stockDocumentLedger(UserCreditNoteDetail ledger) += userCreditNote(ledger);
type(UserCreditNote l) += STRING[50]('Акт расхождения (продажа)') IF l IS UserCreditNote;

overSumItem = ABSTRACT NUMERIC[18,4](UserCreditNote);
sumItem (UserCreditNote ledger) += OVERRIDE overSumItem(ledger), shipmentSumItemUserCreditNoteDetail(ledger);

overSumContainer = ABSTRACT NUMERIC[18,4](UserCreditNote);
sumContainer (UserCreditNote ledger) += OVERRIDE overSumContainer(ledger), shipmentSumContainerUserCreditNoteDetail(ledger);

legalEntity(UserCreditNote ledger) += customer(ledger);
legalEntityStock(UserCreditNote ledger) += customerStock(ledger); 

operation[StockDocumentLedger](UserCreditNote ledger) += operation(ledger);
isReturn(UserCreditNote ledger) += ledger IS UserCreditNote;
close[StockDocumentLedger](UserCreditNote l) + {  close(l); }

// ------------------------------- Проведение по регистру остатков ------------------------ //
@implementSkuLedgerInLIFO(UserCreditNoteDetail, sku, supplierStock);

quantity[InLIFOSkuLedger] (UserCreditNoteDetail ledger) += shipmentQuantity(ledger);
batch[SkuLedger](UserCreditNoteDetail ledger) += batch(ledger);
@implementSkuLedgerInLIFOBatchBalance(userCreditNoteDetail, supplierStock);

overSum = ABSTRACT NUMERIC[18,4] (UserCreditNoteDetail);
extraSum = ABSTRACT NUMERIC[18,4] (UserCreditNoteDetail); // для сохранения обратной совместимости
sum[InSkuLedger](UserCreditNoteDetail ledger) += OVERRIDE overSum(ledger), extraSum(ledger), shipmentSum(ledger);

show[SkuLedger](UserCreditNoteDetail d) + {  show(d); }