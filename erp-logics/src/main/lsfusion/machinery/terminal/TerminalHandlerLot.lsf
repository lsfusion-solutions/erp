MODULE TerminalHandlerLot;

REQUIRE TerminalHandler, TerminalLot;

NAMESPACE TerminalHandler;

process (TerminalDocument document) + {
    FOR marking(TerminalDocumentDetail d) AND terminalDocument(d) == document AND count(INTEGER i, jsonArrayLength(marking(d))) AND STRING mark = jsonArrayElement(marking(d), i, 'id') DO NEW l = TerminalLotDetail {
        id(l) <- STRING[200](mark);
        quantity(l) <- NUMERIC[14,3](jsonArrayElement(marking(d), i, 'quantity'));
        terminalDocumentDetail(l) <- d;
    } 
} 
