MODULE WriteOffBinLedgerFuel;

REQUIRE WriteOffBinLedger, BinLedgerFuel, WriteOffFuel;

NAMESPACE WriteOff;

volume[BinLedger] (WriteOffBinLedger ledger) += volume(writeOffDetail(ledger));
density[BinLedger] (WriteOffBinLedger ledger) += density(writeOffDetail(ledger));

densityBOutBin 'Плотность расчётная в резервуаре (до), кг/л' (UserWriteOffDetail writeOffDetail) = prevDensityB(outBin(writeOffDetail), dateTime(writeOffDetail));
lastDailyReportDensityOutBin 'Плотность наблюдаемая в резервуаре (из), кг/л' (UserWriteOffDetail writeOffDetail) = lastDailyReportDensity(sku(writeOffDetail), outBin(writeOffDetail));

fillDensityDailyReportOutBin 'Заполнить плотностью наблюдаемой (из последнего сменного отчёта)' (UserWriteOffDetail d) {
    IF lastDailyReportDensityOutBin(d) THEN {
        fillDensity(d, lastDailyReportDensityOutBin(d));
    } ELSE {
        MESSAGE 'Отсутствует плотность наблюдаемая (из последнего сменного отчёта)' NOWAIT;
    }
} ASON CONTEXTMENU density[UserWriteOffDetail];

fillDensityAOutBin 'Заполнить расчётным значением плотности в резервуаре (до)' (UserWriteOffDetail d) {
    IF densityBOutBin(d) THEN {
        fillDensity(d,densityBOutBin(d));
    } ELSE {
        MESSAGE 'Отсутствует плотность расчётная в резервуаре (до)' NOWAIT;
    }
} ASON CONTEXTMENU density[UserWriteOffDetail];

//overBackgroundDensity(UserWriteOffDetail d) += WHEN density(d) != densityBOutBin(d) THEN RGB(255,154,154);

EXTEND FORM userWriteOff
    PROPERTIES(d) READONLY AFTER nameOutBin(d) densityBOutBin BACKGROUND backgroundBins(w)
;

//----------------------------- переименование ячейки в резервуар -----------------------------//
DESIGN operation {
    PROPERTY(useBins(o)) { caption = 'Резервуары'; }
    PROPERTY(nameInBin(o,stc)) { caption = 'Резервуар (в)'; }
    PROPERTY(nameOutBin(o,stc)) { caption = 'Резервуар (из)'; }
}
DESIGN userWriteOff {
    headerBins { caption = 'Резервуары'; }
    PROPERTY(useBins(w)) { caption = 'Резервуары'; }
    PROPERTY(nameInBin(w)) { caption = 'Резервуар (в)'; }
    PROPERTY(nameOutBin(w)) { caption = 'Резервуар (из)'; }
    PROPERTY(nameInBin(d)) { caption = 'Резервуар (в)'; }
    PROPERTY(nameOutBin(d)) { caption = 'Резервуар (из)'; }
}
DESIGN writeOffs {
    PROPERTY(nameInBin(d)) { caption = 'Резервуар (в)'; }
    PROPERTY(nameOutBin(d)) { caption = 'Резервуар (из)'; }
}
