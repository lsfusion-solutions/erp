MODULE WeightDaemon;

REQUIRE SystemEvents;

scalesComPort 'Com-port весов' = DATA INTEGER (Computer);
EXTEND FORM computer PROPERTIES(c) scalesComPort;
EXTEND FORM computers PROPERTIES(c) READONLY scalesComPort;
EXTEND FORM computersDialog PROPERTIES(c) READONLY scalesComPort;

vidScalesComPort 'VID весов' = DATA STRING[4] (Computer);
pidScalesComPort 'PID весов' = DATA STRING[4] (Computer);

EXTEND FORM computer PROPERTIES(c) vidScalesComPort, pidScalesComPort; 

jsonScalesComPort (Computer c) = JSON(FROM vid = vidScalesComPort(c), pid = pidScalesComPort(c)); 

weightDaemon  INTERNAL  'lsfusion.erp.daemon.WeightDaemonAction' (INTEGER);
onDesktopClientStarted() + {
    weightDaemon(scalesComPort(currentComputer()));
}