MODULE SupplierEInvoiceEDN;

REQUIRE EInvoiceEDN, SupplierEInvoiceTopByApi, EInvoiceEDSEDN;

NAMESPACE EDI;

signAndSendSupplier(EInvoice e) + {
    IF EDIProviderInvoice(customer(e), supplier(e)) == EDIProvider.edn THEN
        IF exportedSupplier(e) THEN MESSAGE 'Накладная (поставщик) уже отправлена';
        ELSE IF isTN2(e) THEN {
            hideMessageHeaderBlrdln() <- extractEDN(supplier(e));
            signAndSendSupplierEInvoiceTN2(e, loginEDN(supplier(e)), passwordEDN(supplier(e)), ('https://' + hostEDN(supplier(e)) +':' + portEDN(supplier(e)) + '/topby/DmcService?wsdl'), (OVERRIDE overInvoiceOutputDirEDN(e),outputDirEDN()), 'EDN');
        } ELSE {
            hideMessageHeaderBlrwbl() <- extractEDN(supplier(e));
            signAndSendSupplierEInvoice(e, loginEDN(supplier(e)), passwordEDN(supplier(e)), ('https://' + hostEDN(supplier(e)) +':' + portEDN(supplier(e)) + '/topby/DmcService?wsdl'), (OVERRIDE overInvoiceOutputDirEDN(e),outputDirEDN()), 'EDN');
        }
}

signAndSendBlrapnSupplier(EInvoice e) + {
    IF EDIProviderInvoice(customer(e), supplier(e)) == EDIProvider.edn THEN
        IF exportedBlrapnSupplier(e) THEN MESSAGE 'Извещение о прочтении (поставщик) уже отправлено';
        ELSE {
            hideMessageHeaderBlrapn() <- extractEDN(supplier(e));
            signAndSendBlrapnSupplierEInvoice(e, loginEDN(supplier(e)), passwordEDN(supplier(e)), ('https://' + hostEDN(supplier(e)) +':' + portEDN(supplier(e)) + '/topby/DmcService?wsdl'), (OVERRIDE overInvoiceOutputDirEDN(e), outputDirEDN()), 'EDN', TRUE);
        }
}
