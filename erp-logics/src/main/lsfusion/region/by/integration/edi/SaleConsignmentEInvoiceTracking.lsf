MODULE SaleConsignmentEInvoiceTracking;

REQUIRE ConsignmentEInvoiceTracking, SaleInvoiceTracking;

NAMESPACE Sale;

trackingInvoiceDetail [ConsignmentDetail](InvoiceDetail cd) += Sale.trackingInvoiceDetail(cd);

skipCheckBasisSale = DATA BOOLEAN ();

CONSTRAINT (SET(isPosted(UserInvoiceDetail id)) OR SETCHANGED(sku(id)) OR CHANGED(batch(id)) OR CHANGED(trackingInvoiceDetail(id))) AND isPosted(id) AND isTracking(id)
    AND batch(id) AND date(id) >= dateStartSPT() AND NOT (deliveryNotePrev(id) OR deliveryTypePrev(id)) AND NOT trackingInvoiceDetail(id) AND NOT skipCheckBasisSale()
    MESSAGE 'Укажите основание для прослеживаемого товара, отсутствуют данные для СПТ' ;